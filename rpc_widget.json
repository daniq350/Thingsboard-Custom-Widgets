{
  "alias": "rpc_widget",
  "name": "RPC Widget",
  "image": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAACgCAAAAABslHx1AAAAAmJLR0QA/4ePzL8AAAN8SURBVHja7dvbSxRRHAfw/X9+bhcvrJZSmllhZFSCWBDaY4FUhBRZCQXR7akLyoJYlqxU0g0tukF0oYQM3bxsYVRgbuuyu7k7szNn9vSb2Wx9qB56ac72/T7MHGYZmA/nMjvDbzzSTkbpOASPw7CUjkPx2AwhTNNQNKYphE1hiCXMtK5pWkrB8GXraZMl0sMOQ9dEdqApmIzQdIMlDDH1lLIMh5LSTYZYIp1MS6XDAGF5uEPiltoQK85dwhAtKhVPVLMhRj5ADAcyqzpkNgtJqQ9JAQIIIIAAAggggAACCCB/8wog8btfAjd+f9Y3t0GmW5bS8rO/fvavaXB2jWVlZbVHwjLC+7L1x2P8rN1ZQcWtX90EyWws7r7bSuf+BKnz+f1t3norTPV+/0HvNiFP0+5b54sahYsgn+mQrdksZfL6hYcZGe2betoxyG/LtP7OiXlIJW/a6F2Y9nPjKI3MLtrBjbM05CJIsqT6tdOI1BbWFuyRQVpbupw7yGygqqLCBZCTNJqFdNGTAQpwY2bwo5vmyL1iqr+uS3l4yaTsoaEg7bT0VXWyn/xyquQHpDz4JuCrFWHaG48OrSuJXqLHLly1Yl01VDkuq6r7+i5Qd5ABsqlctlMiN0eI0/BZhu09rXggu10J4TVoYMlWWeKr51x2IM3lcp83k4NUfAqVbrQYsn3w/lvuvTt0lQ9Hn027CNJLt3m7YaXctIaXYCHnIWfog5Src3Okg/pldo7Ys8O7S9qHXrgIEllWee35uYJ9MkAHXgVq3s9Dxguan56iHCRZUa3/hPDAa3/U7dtiuGloTTZ7aXFrnO9xPio8Zs5D5JViaqpbsGpdpK4cxDxRRItbpl02R1Jfsje2zIy+8LCI/ekkc0a4b7Lj3y8ggAACCCCAAAIIIIAA8v9C8qaoRosqXngmsmVOXHgWVxsSyxaemXosJFR2mBMxpxRQpOPB0YihKsOIjAbjdnEml8vOhUaGX97s7VEwvTdfDo+E5kyn7pe7JDQWVDZjIbtDMk5JuZGcSyQScQXDlz2XNJyS8vwp8s+bzy6kzJsPYfIigAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggg/yTfATinNXQTM7TQAAAAAElFTkSuQmCC",
  "description": "Allows to send RPC command when user press the button.",
  "descriptor": {
    "type": "rpc",
    "sizeX": 8.5,
    "sizeY": 7.5,
    "resources": [],
    "templateHtml": "<form #rpcForm=\"ngForm\" (submit)=\"sendCommand()\">\r\n      <div class=\"mat-content mat-padding\" fxLayout=\"column\">\r\n        <mat-form-field class=\"mat-block\">\r\n          <mat-label>CLI Command</mat-label>\r\n          <input matInput required name=\"rpcParams\" #rpcParamsField=\"ngModel\" [(ngModel)]=\"rpcParams\"/>\r\n          <mat-error *ngIf=\"rpcParamsField.hasError('required')\">\r\n            CLI Command is Required.\r\n          </mat-error>\r\n        </mat-form-field>\r\n        <button [disabled]=\"rpcForm.invalid || !rpcForm.dirty\" mat-raised-button color=\"primary\" type=\"submit\" >\r\n          Run!\r\n        </button>\r\n    \r\n        <div>\r\n          <label>RPC Output</label>\r\n          <div style=\"width: 100%; height: 400px; border: solid 2px gray;white-space: pre-wrap;overflow: scroll;\" [innerHTML]=\"rpcCommandResponse\">\r\n          </div>\r\n        </div>\r\n        \r\n        \r\n      </div>\r\n    </form>\r\n    \r\n    <div class=\"btn-group\">\r\n \r\n \r\n</div>",
    "templateCss": ".tb-rpc-button {\n    width: 100%;\n    height: 100%;\n   \n}\n\n.tb-rpc-button .title-container {\n    font-weight: 500;\n    white-space: nowrap;\n    margin: 10px 0;\n}\n\n.tb-rpc-button .button-container div{\n    min-width: 80%\n}\n\n.tb-rpc-button .button-container .mat-button{\n    width: 100%;\n    margin: 0;\n}\n\n.tb-rpc-button .error-container {\n    position: absolute;\n    top: 2%;\n    right: 0;\n    left: 0;\n    z-index: 4;\n    height: 14px;\n}\n\n.tb-rpc-button .error-container .button-error {\n    color: white;\n    white-space: nowrap;\n}\n\n.btn-group button {\n  background-color: #6B7B8C; /* Green background */\n  border: 4px solid white; /* Green border */\n  border-color: #98a3ae;\n  color: black; /* White text */\n  padding: 10px 12px; /* Some padding */\n  cursor: pointer; /* Pointer/hand icon */\n  float: left; /* Float the buttons side by side */\n  \n}\n\n/* Clear floats (clearfix hack) */\n.btn-group:after {\n  content: \"\";\n  clear: both;\n  display: table;\n}\n\n.btn-group button:not(:last-child) {\n  border-right: none; /* Prevent double borders */\n}\n\n/* Add a background color on hover */\n.btn-group button:hover {\n  background-color: #001aff;\n  color: white;\n}",
    "controllerScript": "self.onInit = function() {\r\n console.log(\"Device CLI Command - onInit() start\");\r\n    \r\n    self.ctx.$scope.sendCommand = function() {\r\n        console.log(\"Device CLI Command - sendCommand() start\");\r\n        var rpcMethod = self.ctx.$scope.rpcParams;\r\n        console.log(\"Device CLI Command - sendCommand() - rpcMethod = \"+ rpcMethod);\r\n      \r\n        var rpcParams = \"\";\r\n        console.log(\"Device CLI Command - sendCommand() - rpcParams = \"+ rpcParams);\r\n        var timeout = self.ctx.settings.requestTimeout;\r\n        var oneWayElseTwoWay = self.ctx.settings.oneWayElseTwoWay ? true : false;\r\n        console.log(\"Device CLI Command - sendCommand() - oneWay? = \"+ oneWayElseTwoWay);\r\n        var commandObservable;\r\n        if (oneWayElseTwoWay) {\r\n            commandObservable = self.ctx.controlApi.sendOneWayCommand(rpcMethod, rpcParams, timeout);\r\n        } else {\r\n            commandObservable = self.ctx.controlApi.sendTwoWayCommand(rpcMethod, rpcParams, timeout);\r\n        }\r\n        commandObservable.subscribe(\r\n            \r\n            function (response) {\r\n                console.log(\"Device CLI Command - commandObservable.subscribe.onResponse() - start\");\r\n                if (oneWayElseTwoWay) {\r\n                    self.ctx.$scope.rpcCommandResponse = \"start command sent to device\";\r\n                } else {\r\n                    self.ctx.$scope.rpcCommandResponse = \"Response from device:<br>\";  \r\n                    console.log(response['response']);\r\n                    self.ctx.$scope.rpcCommandResponse += response['response'];\r\n                }\r\n                self.ctx.detectChanges();\r\n                console.log(\"Device CLI Command - commandObservable.subscribe.onResponse() - done\");\r\n            },\r\n            function (rejection) {\r\n                console.log(\"Device CLI Command - commandObservable.subscribe.onError() - start\");\r\n                console.log(\"Device CLI Command - commandObservable.subscribe.onError() - rejection = \" + rejection);\r\n                self.ctx.$scope.rpcCommandResponse = \"Failed to send command to the device:<br>\"\r\n                self.ctx.$scope.rpcCommandResponse += \"Status: \" + rejection.status + \"<br>\";\r\n                self.ctx.$scope.rpcCommandResponse += \"Status text: '\" + rejection.statusText + \"'\";\r\n                self.ctx.detectChanges();\r\n                console.log(\"Device CLI Command - commandObservable.subscribe.onError() - done\");\r\n            }\r\n            \r\n        ); // end of subscribe()\r\n        console.log(\"Device CLI Command - sendCommand() done\");\r\n    }\r\n    console.log(\"Device CLI Command - onInit() done\");\r\n}",
    "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"properties\": {\n            \"title\": {\n                \"title\": \"Widget title\",\n                \"type\": \"string\",\n                \"default\": \"\"\n            },\n            \"buttonText\": {\n                \"title\": \"Button label\",\n                \"type\": \"string\",\n                \"default\": \"Start Scan\"\n            },\n            \"oneWayElseTwoWay\": {\n                \"title\": \"Is One Way Command\",\n                \"type\": \"boolean\",\n                \"default\": true\n            },\n            \"showError\": {\n                \"title\": \"Show RPC command execution error\",\n                \"type\": \"boolean\",\n                \"default\": false\n            },\n            \"methodName\": {\n                \"title\": \"RPC method\",\n                \"type\": \"string\",\n                \"default\": \"rpcCommand\"\n            },\n            \"methodParams\": {\n                \"title\": \"RPC method params\",\n                \"type\": \"string\",\n                \"default\": \"{}\"\n            },\n            \"requestTimeout\": {\n                \"title\": \"RPC request timeout\",\n                \"type\": \"number\",\n                \"default\": 5000\n            },\n            \"requestPersistent\": {\n                \"title\": \"RPC request persistent\",\n                \"type\": \"boolean\",\n                \"default\": false\n            },\n            \"persistentPollingInterval\": {\n                \"title\": \"Polling interval in milliseconds to get persistent RPC command response\",\n                \"type\": \"number\",\n                \"default\": 5000,\n                \"minimum\": 1000\n            },\n            \"styleButton\": {\n                \"type\": \"object\",\n                \"title\": \"Button Style\",\n                \"properties\": {\n                    \"isRaised\": {\n                        \"type\": \"boolean\",\n                        \"title\": \"Raised\",\n                        \"default\": true\n                    },\n                    \"isPrimary\": {\n                        \"type\": \"boolean\",\n                        \"title\": \"Primary color\",\n                        \"default\": false\n                    },\n                    \"bgColor\": {\n                        \"type\": \"string\",\n                        \"title\": \"Button background color\",\n                        \"default\": null\n                    },\n                    \"textColor\": {\n                        \"type\": \"string\",\n                        \"title\": \"Button text color\",\n                        \"default\": null\n                    }\n                }\n            },\n            \"required\": []\n        }\n    },\n    \"form\": [\n        \"title\",\n        \"buttonText\",\n        \"oneWayElseTwoWay\",\n        \"showError\",\n        \"methodName\",\n        {\n            \"key\": \"methodParams\",\n            \"type\": \"json\"\n        },\n        \"requestTimeout\",\n        \"requestPersistent\",\n        {\n            \"key\": \"persistentPollingInterval\",\n            \"condition\": \"model.requestPersistent === true\"\n        },\n        {\n            \"key\": \"styleButton\",\n            \"items\": [\n                \"styleButton.isRaised\",\n                \"styleButton.isPrimary\",\n                {\n                    \"key\": \"styleButton.bgColor\",\n                    \"type\": \"color\"\n                },\n                {\n                    \"key\": \"styleButton.textColor\",\n                    \"type\": \"color\"\n                }\n            ]\n        }\n    ]\n\n}",
    "dataKeySettingsSchema": "{}\n",
    "defaultConfig": "{\"targetDeviceAliases\":[],\"showTitle\":false,\"backgroundColor\":\"#e6e7e8\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"0px\",\"settings\":{\"requestTimeout\":5000,\"oneWayElseTwoWay\":false,\"buttonText\":\"Send RPC\",\"styleButton\":{\"isRaised\":true,\"isPrimary\":false},\"methodName\":\"ee getconfig\",\"methodParams\":\"{}\",\"showError\":false,\"requestPersistent\":false},\"title\":\"RPC Widget\",\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{},\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"useDashboardTimewindow\":true,\"showLegend\":false,\"actions\":{},\"enableDataExport\":true,\"widgetCss\":\"\",\"noDataDisplayMessage\":\"\"}"
  }
}